# RPi-Availability-Tracker
I wanted to see if I could out-bot the scalpers and get my hands on a Raspberry Pi 4 and Zero 2 W so I started this project!
## [main] branch
This branch reflects my inital idea for the script which was to have it run as an infinite loop:
```python
while True:
    # get request
    # send email if anything has changed
    # sleep for a minute
```
This method proved to be pretty straightforward and easy to set up. The hardest part was setting up the SMTP connection, but fortunately [Corey Schafer](https://youtu.be/JRCJ6RtE3xU) did all the hard work already.

In order to get this script up and running on your machine you need to:

1. Clone the repository
```bash
git clone https://github.com/James-Loewen/RPi-Availability-Tracker.git
```
2. Set up your own environment variables with your login credentials. **I highly recommend this method as opposed to typing your email and password directly into the python file even though that would cut out a few steps.** I did this on a raspberry pi running the latest version of the Linux-based Raspberry Pi OS so I created my variables in $HOME/.bash_profile
```bash
nano $HOME/.bash_profile
```
If this file is empty, it won't be for long! If it isn't, just navigate to the end of the file and maybe add a comment about what you're adding. Here's the syntax for declaring new environment variables:
```bash
# Email credentials for RPi tracking script "track.py"
export EMAIL_USER="the email address you're sending emails from"
export EMAIL_PASS="the password for the account"
export PHONE_NUMBER="I included my phone number so that I could receive texts as well"
export RECIPIENT="whatever email address you want to receive the messages generated by the script"
```
Save and exit by typing Ctrl+X, then y, then ENTER.


If you're setting this script up on a Windows environment using PowerShell (bonus points if you're using the new official Windows Terminal) you'll want to open up your $PROFILE file
```powershell
notepad $PROFILE
```
Once you've got that opened, the syntax for declaring new environment variables is:
```text
$Env:EMAIL_USER = "the email address you're sending emails from"
$Env:EMAIL_PASS = "the password for the account"
$Env:PHONE_NUMBER = "etc..."
$Env:RECIPIENT = "etc..."
```
Save and exit and then all that's left to do is...

3. Start the track.py script.
```bash
# Linux:
python somewhere-on-your-machine/RPi-Availability-Tracker/track.py
# Windows:
py somewhere-on-your-machine/RPi-Availability-Tracker/track.py
```
If you run the script this way, it's going to print out information directly to your shell's standard output, which you might not want.

I don't know how to do this on Windows, but I can show you how to run the script in the background on Linux machines:
```bash
nohup python -u [path to repo dir]/RPi-Availability-Tracker/track.py >> rpi_inventory.log 2>> rpi_tracking_errors.log &
```
When you run this a PID number will be displayed in the terminal. PID stands for "Process Identifier" or "Process ID." You'll need that number in order to kill the process, which you do like this:
```bash
# Let's pretend the PID is 1612
kill 1612
```
If you don't remember what the PID is or if you just want to confirm that the script is still running, you can type the following command:
```bash
ps aux | grep "track.py" | grep -v grep
```
You should get a result that looks like this:
```bash
pi       17704  0.6  0.3  14688  7376 pts/0    S    23:37   0:00 python -u track.py
```
That first number, **17704** is the PID.

Note: by default the script will only alert you to inventory changes of the Raspberry Pi Zero in the United States and Canada. To change this, edit the params dictionary in the rpi_request.py file:
```python
params = {
    # options: ["CM4", "PI3", "PI4", "PIZERO"]
    "cat": ["PIZERO"],
    # options: AT, BE, CA, CN, FR, DE, IT, JP, NL,
    #          PL, PT, ZA, ES, SE, CH, UK, US
    "country": ["US", "CA"]
}
```
